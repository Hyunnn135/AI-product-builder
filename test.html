<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">ìŒì‹ ì„ í˜¸ë„ í…ŒìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="top-right-buttons">
            <button id="theme-toggle">ğŸŒ™</button> <!-- Added theme toggle -->
            <button id="language-toggle">EN</button>
        </div>
        <h1 id="page-title">ë°¥ vs ë©´: ë‹¹ì‹ ì˜ ì·¨í–¥ì€?</h1>
        <p id="page-description">ì›¹ìº ì„ í†µí•´ ë‹¹ì‹ ì´ ë°¥ì„ ì¢‹ì•„í•˜ëŠ”ì§€, ë©´ì„ ì¢‹ì•„í•˜ëŠ”ì§€ ì¸ê³µì§€ëŠ¥ì´ ë¶„ì„í•´ ë“œë¦½ë‹ˆë‹¤!</p>
        <div id="webcam-container"></div>
        <div id="label-container"></div>
        <button type="button" id="startButton" class="primary-button">í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
        <a href="/" class="home-link" id="home-link">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        const URL = "https://teachablemachine.withgoogle.com/models/B2G9-Yg46/";
        let model, webcam, labelContainer, maxPredictions;

        const elementsToTranslate = {
            'page-title': {
                'ko': 'ë°¥ vs ë©´: ë‹¹ì‹ ì˜ ì·¨í–¥ì€?',
                'en': 'Rice vs Noodles: Your Preference?'
            },
            'page-description': {
                'ko': 'ì›¹ìº ì„ í†µí•´ ë‹¹ì‹ ì´ ë°¥ì„ ì¢‹ì•„í•˜ëŠ”ì§€, ë©´ì„ ì¢‹ì•„í•˜ëŠ”ì§€ ì¸ê³µì§€ëŠ¥ì´ ë¶„ì„í•´ ë“œë¦½ë‹ˆë‹¤!',
                'en': 'Through your webcam, AI will analyze whether you prefer rice or noodles!'
            },
            'startButton': {
                'ko': 'í…ŒìŠ¤íŠ¸ ì‹œì‘',
                'en': 'Start Test'
            },
            'home-link': {
                'ko': 'ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°',
                'en': 'Go back to Main'
            }
        };

        function setLanguage(lang) {
            document.documentElement.lang = lang;
            for (const id in elementsToTranslate) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = elementsToTranslate[id][lang];
                }
            }
            const languageToggleButton = document.getElementById('language-toggle');
            if (languageToggleButton) {
                languageToggleButton.textContent = (lang === 'ko' ? 'EN' : 'KO');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const startButton = document.getElementById('startButton');
            const languageToggleButton = document.getElementById('language-toggle');
            const themeToggleButton = document.getElementById('theme-toggle'); // Get theme toggle button
            const body = document.body; // Get body element

            // Language functionality
            let currentLang = localStorage.getItem('lang') || 'ko';
            setLanguage(currentLang);

            languageToggleButton.addEventListener('click', () => {
                currentLang = (currentLang === 'ko' ? 'en' : 'ko');
                localStorage.setItem('lang', currentLang);
                setLanguage(currentLang);
            });

            // Theme toggle functionality (similar to main.js)
            themeToggleButton.addEventListener('click', () => {
                body.classList.toggle('dark-mode');
                const isDarkMode = body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                themeToggleButton.textContent = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
            });

            // Load saved theme from localStorage (similar to main.js)
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                body.classList.add('dark-mode');
                themeToggleButton.textContent = 'â˜€ï¸';
            } else {
                body.classList.remove('dark-mode');
                themeToggleButton.textContent = 'ğŸŒ™';
            }

            startButton.addEventListener('click', init);
        });

        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            const flip = true;
            webcam = new tmImage.Webcam(200, 200, flip);
            await webcam.setup();
            await webcam.play();
            window.requestAnimationFrame(loop);

            document.getElementById("webcam-container").appendChild(webcam.canvas);
            labelContainer = document.getElementById("label-container");
            for (let i = 0; i < maxPredictions; i++) {
                labelContainer.appendChild(document.createElement("div"));
            }
            document.getElementById('startButton').style.display = 'none';
        }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            for (let i = 0; i < maxPredictions; i++) {
                const classPrediction =
                    prediction[i].className + ": " + prediction[i].probability.toFixed(2);
                labelContainer.childNodes[i].innerHTML = classPrediction;
            }
        }
    </script>
</body>
</html>